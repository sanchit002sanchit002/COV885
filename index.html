<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="robots" content="noindex">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="lecture 7 transcription">
<link rel="icon" href="logos/favicon.ico" type="image/x-icon">
 <style type="text/css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}</style>
 <style type="text/css">:root{--primaryColor:#373B44}code,pre{font-family:Menlo,Monaco,'Courier New',monospace;font-size:.8rem}pre{padding:.5rem;line-height:1.25;overflow-x:scroll}code,pre{background-color:#fafafa}a,a:visited{color:#3498db}a:active,a:focus,a:hover{color:#2980b9}html{font-size:12px}@media screen and (min-width:32rem) and (max-width:42rem){html{font-size:15px}}@media screen and (min-width:48rem){html{font-size:16px}}body{line-height:1.85;counter-reset:section}p{font-size:1rem;margin-bottom:1.3rem}h1,h2,h3,h4{margin:1.414rem 0 .5rem;font-weight:inherit;line-height:1.42}:root{--fontSizeBase:1rem}@media (max-width:770px){:root{--fontSizeBase:0.7rem}}h1{font-size:calc(var(--fontSizeBase) * 3)}h2{font-size:calc(var(--fontSizeBase) * 2)}h3{font-size:calc(var(--fontSizeBase) * 1.44)}h4{font-size:calc(var(--fontSizeBase) * 1.3)}h5{font-size:calc(var(--fontSizeBase) * 1.121)}h6{font-size:calc(var(--fontSizeBase) * .88)}small{font-size:.707em}canvas,iframe,img,select,svg,textarea,video{max-width:100%}html{font-size:18px;max-width:100%}body{color:#444;font-family:'Open Sans Condensed',sans-serif;font-weight:300;line-height:1.45}h1,h2,h3,h4,h5,h6{font-family:Arimo,Helvetica,sans-serif}h1,h2,h3{border-bottom:2px solid var(--primaryColor);margin-bottom:1.15rem;padding-bottom:.5rem;text-align:right}h1{border-bottom:2px solid var(--primaryColor)}blockquote{border-left:8px solid #fafafa;padding:1rem}*{box-sizing:border-box;margin:0;padding:0}:root{font-size:calc(1rem + 1vw)}body{font-size:1.2rem;overflow-y:hidden}.slider{font-family:sans-serif;-webkit-scroll-snap-type:x mandatory;-ms-scroll-snap-type:x mandatory;scroll-snap-type:x mandatory;display:-webkit-box;display:flex;overflow-x:scroll}section{scroll-snap-align:start;min-width:100vw;height:100vh;position:relative}section>*{margin:1em auto;max-width:80vw;margin-top:.5em}h1{text-align:right;font-size:calc(1rem + 3vw)}.notes{display:none}section::after{position:absolute;left:96px;bottom:48px;color:var(--primaryColor);counter-increment:section;content:counter(section)}@media (max-width:770px){section::after{top:10px;left:10px}}ul{font-size:1rem;padding-left:20px}ul ul{padding-left:50px}p.left{font-size:calc(1rem + 1vw);color:#cc3838}.input-color{position:relative}.input-color input{padding-left:20px}.input-color .color-box{width:50px;height:50px;display:inline-block;background-color:#ccc;left:5px;top:5px}.input-colors{padding-left:100px}hr{border:1px solid var(--primaryColor)}div.diagramScale{padding-top:0;padding-bottom:0;margin-top:-1em;margin-bottom:-1em}div.Author{text-align:center}div.Affiliations{display:table;align-content:center}div.Affiliation{display:table-cell}div.Affiliation+div.Affiliation{padding-left:2em}div.Affiliation>p{white-space:pre-line;text-align:center}div.Affiliation>p>img{padding-top:1em}kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:solid 1px #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}.btn{position:absolute;top:50%;transform:translateY(-50%);height:30px;width:30px;border-radius:2px;background-color:rgba(0,0,0,.5);background-position:50% 50%;background-repeat:no-repeat;z-index:1}.btn.next{background-image:url('data:image/svg+xml;charset=utf-8,<svg width="18" height="18" viewBox="0 0 34 34" xmlns="http://www.w3.org/2000/svg"><title>Shape</title><path d="M25.557 14.7L13.818 2.961 16.8 0l16.8 16.8-16.8 16.8-2.961-2.961L25.557 18.9H0v-4.2z" fill="%23FFF" fill-rule="evenodd"/></svg>');right:10px}.btn.prev{background-image:url('data:image/svg+xml;charset=utf-8,<svg width="18" height="18" viewBox="0 0 34 34" xmlns="http://www.w3.org/2000/svg"><title>Shape</title><path d="M33.6 14.7H8.043L19.782 2.961 16.8 0 0 16.8l16.8 16.8 2.961-2.961L8.043 18.9H33.6z" fill="%23FFF" fill-rule="evenodd"/></svg>');left:10px}.caption{font-size:20pt}.source{font-size:14pt}.red{color:#f7a}strong{font-weight:700}.directlinks{position:absolute;font-size:small;text-align:right;top:95%;right:0;transform:translateY(90%);height:30px}.directlink{color:#fff;padding:5px;border-radius:2px;background-position:50% 50%;background-repeat:no-repeat;z-index:1}.directlink>a{color:#fff;border-radius:5px;padding:1px;text-decoration:none;background-color:rgba(0,0,0,.5)}</style>
 <script type="text/javascript">MathJax={loader:{load:["a11y/explorer"]},tex:{inlineMath:[["$","$"]]},options:{renderActions:{assistiveMml:[],setExplorerValues:[199,e=>{for(const t of e.math)MathJax.config.setExplorer(t,e)},(e,t)=>MathJax.config.setExplorer(e,t)]}},currentMathFocus:null,setExplorer(e,t){e.typesetRoot.addEventListener("focusin",(function(){const e="braille"===this.parentNode.id||this.parentNode.parentNode&&"braille"===this.parentNode.parentNode.id;MathJax.config.currentMathFocus=this;const o=t.menu.menu.variablePool;e?(o.lookup("braille").setValue(!0),o.lookup("viewBraille").setValue(!0),o.lookup("subtitles").setValue(!1)):(o.lookup("braille").setValue(!1),o.lookup("viewBraille").setValue(!1),o.lookup("subtitles").setValue(!0))}))}};</script>
 <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3.1.0/es5/tex-mml-chtml.js"></script>
 <script type="text/javascript">!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.cacc=e():t.cacc=e()}(this,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=7)}([function(t,e,i){"use strict";function n(t){return e.prefix_+"-"+t}Object.defineProperty(e,"__esModule",{value:!0}),e.children=e.classList=e.getAttribute=e.getTextContent=e.toggleExpertMode=e.EXPERT_MODE=e.toArray=e.getId=e.idCounter_=e.addPrefix=e.prefix_=void 0,e.prefix_="cacc",e.addPrefix=n,e.idCounter_=0,e.getId=function(){return n("Id-"+e.idCounter_++)},e.toArray=function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i]);return e},e.EXPERT_MODE=!1,e.toggleExpertMode=function(){e.EXPERT_MODE=!e.EXPERT_MODE},e.getTextContent=function(t){var e=t.textContent;return" "!==e&&(e=e.replace(/^\s*/,"")),e},e.getAttribute=function(t,e){return t.getAttribute(e)||t.getAttributeNS("http://www.chemaccess.org/sre-schema",e)||t.getAttribute("sre:"+e)},function(t){function e(t,e){t.classList&&t.classList.add?t.classList.add(e):t.className?n(t.className)?t.className.baseVal+=" "+e:t.className+=" "+e:t.className=e}function i(t,e){if(t.classList&&t.classList.remove&&t.classList.remove(e),t.className){var i=t.className;n(i)?i.baseVal=i.baseVal.replace(" "+e,""):t.className=t.className.replace(" "+e,"")}}function n(t){return"string"!=typeof t}t.add=e,t.remove=i,t.toggle=function(t,o){t.classList&&t.classList.toggle?t.classList.toggle(o):t.className?function(t,e){return-1!==(n(t)?t.baseVal:t).search(e)}(t.className,o)?i(t,o):e(t,o):t.className=o}}(e.classList||(e.classList={})),e.children=function(t){if(t.children)return Array.prototype.slice.call(t.children);for(var e=[],i=t.childNodes,n=0,o=void 0;o=i[n];n++)1===o.nodeType&&e.push(o);return e}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CustomEvent=e.EventType=e.KeyCodes=void 0,function(t){t[t.RETURN=13]="RETURN",t[t.ENTER=13]="ENTER",t[t.ESC=27]="ESC",t[t.SPACE=32]="SPACE",t[t.LEFT=37]="LEFT",t[t.UP=38]="UP",t[t.RIGHT=39]="RIGHT",t[t.DOWN=40]="DOWN",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z"}(e.KeyCodes||(e.KeyCodes={})),function(t){t.CLICK="click",t.DBLCLICK="dblclick",t.MOUSEDOWN="mousedown",t.MOUSEUP="mouseup",t.MOUSEOVER="mouseover",t.MOUSEOUT="mouseout",t.MOUSEMOVE="mousemove",t.SELECTSTART="selectstart",t.KEYPRESS="keypress",t.KEYDOWN="keydown",t.KEYUP="keyup",t.TOUCHSTART="touchstart",t.TOUCHMOVE="touchmove",t.TOUCHEND="touchend",t.TOUCHCANCEL="touchcancel"}(e.EventType||(e.EventType={}));var n=function(){function t(t,e,i){this.src=t,this.type=e,this.callback=i,this.src=t,this.type=e,this.callback=i}return t.prototype.add=function(){this.src.addEventListener(this.type,this.callback)},t.prototype.remove=function(){this.src.removeEventListener(this.type,this.callback)},t}();e.CustomEvent=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Base=void 0;var n=i(8),o=i(18),r=i(3),s=i(29),a=function(){function t(){this.version="0.1.1",this.explorerMap={},this.molMap=s.forDocument()}return t.prototype.init=function(){for(var t in Object.keys(this.molMap).length>0&&r.documentCmlStyle(),this.molMap)this.initElement(t,this.molMap[t])},t.prototype.initElement=function(t,e){if(e.hasAttribute("has-svg")&&e.hasAttribute("has-cml")||this.redoInitElement_(t,e),"true"===e.getAttribute("has-svg")&&"true"===e.getAttribute("has-cml")){e.setAttribute("tabindex","0"),e.setAttribute("role","application");var i=e.querySelector("div.svg").children[0],s=e.querySelector("div.cml").children[0];if(i&&s){i.setAttribute("aria-hidden","true"),s.setAttribute("aria-hidden","true");var a=new o.Molecule(e,i,s);this.explorerMap[t]=new n.Explorer(a),r.moleculeStyle(a)}}},t.prototype.redoInitElement_=function(t,e){var i=function(){this.initElement(t,e)}.bind(this);setTimeout(i,500)},t.config={MSG_VISIBLE:!0,MAG_ACTIVE:!0},t}();e.Base=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.replaceStyle_=e.removeStyle_=e.addStyle_=e.svgForegroundStyle_=e.svgBackgroundStyle_=e.svgHighlightStyle_=e.svgBaseStyle_=e.nodeBackgroundStyle_=e.pickScheme=e.moleculeStyle=e.getScheme_=e.colorSchemes_=e.toggleMonochrome=e.toggleTextVisibility=e.documentCmlStyle=void 0;var n=i(0);function o(t){return e.colorSchemes_[t%e.colorSchemes_.length]}function r(t,e){var i=o(e);u(t,i.bkd),s(t.node,i.bkd),l(t,i.frgd),c(t,i.active,i.almost)}function s(t,e){t.style.backgroundColor=e}function a(t){var e="svg."+t.id,i="";i+=e+" { overflow: hidden; }",i+=e+" text { font-size: 16px; font-family: serif; }",i+=e+" text tspan[baseline-shift] { font-weight: 200; font-size: 13px; }",i+=e+" line, svg rect { stroke-width: 1.0;  stroke-linecap: round; }",i+=e+" line.cacc-active, svg g.cacc-active line { stroke-width: 3.0; }",i+=e+" line.cacc-almost, svg g.cacc-almost line { stroke-width: 2.0; }",i+=e+" g.cacc-active text { font-weight: bold; }",i+=e+" g#gridSVG g.cacc-active text { font-weight: bold; }",i+="ul.cacc-controls { list-style-type: none; }",i+="p.cacc-message.cacc-text-invisible { font-size: 1px; }",i+=e+" polyline.cacc-active, svg g.cacc-active polyline { stroke-width: 3.0; }",i+=e+" polyline.cacc-almost, svg g.cacc-almost polyline { stroke-width: 2.0; }",i+=e+" polygon.cacc-active, svg g.cacc-active polygon { stroke-width: 3.0; }",i+=e+" polygon.cacc-almost, svg g.cacc-almost polygon { stroke-width: 2.0; }",i+=e+" path.cacc-active, svg g.cacc-active path { stroke-width: 3.0; }",i+=e+" path.cacc-almost, svg g.cacc-almost path { stroke-width: 2.0; }",i+=e+" rect.cacc-active, svg g.cacc-active rect { stroke-width: 3.0; }",i+=e+" rect.cacc-almost, svg g.cacc-almost rect { stroke-width: 2.0; }",i+=e+" circle.cacc-active, svg g.cacc-active circle { stroke-width: 3.0; }",i+=e+" circle.cacc-almost, svg g.cacc-almost circle { stroke-width: 2.0; }",h(t.node,i,"cacc-base")}function c(t,e,i){var n="svg."+t.id,o="";o+=n+" line.cacc-active, g.cacc-active line { stroke: "+e+"; }",o+=n+" line.cacc-almost, g.cacc-almost line { stroke: "+i+"; }",o+=n+" g.cacc-active text { fill: "+e+"; }",o+=n+" g.cacc-almost text { fill: "+i+"; }",o+=n+" g#gridSVG g.cacc-active text { fill: "+e+"; }",o+=n+" g#gridSVG g.cacc-almost text { fill: "+i+"; }",o+=n+" polyline.cacc-active, g.cacc-active polyline { stroke: "+e+"; }",o+=n+" polyline.cacc-almost, g.cacc-almost polyline { stroke: "+i+"; }",o+=n+" polygon.cacc-active, g.cacc-active polygon { stroke: "+e+"; }",o+=n+" polygon.cacc-almost, g.cacc-almost polygon { stroke: "+i+"; }",o+=n+" path.cacc-active, g.cacc-active path { stroke: "+e+"; }",o+=n+" path.cacc-almost, g.cacc-almost path { stroke: "+i+"; }",o+=n+" rect.cacc-active, g.cacc-active rect { stroke: "+e+"; }",o+=n+" rect.cacc-almost, g.cacc-almost rect { stroke: "+i+"; }",o+=n+" circle.cacc-active, g.cacc-active circle { stroke: "+e+"; }",o+=n+" circle.cacc-almost, g.cacc-almost circle { stroke: "+i+"; }",f(t.node,o,"cacc-color-highlight")}function u(t,e){var i="svg."+t.id,n="";n+=i+" { background-color: "+e+"; }",n+=i+" g.atom rect { stroke: "+e+"; fill: "+e+"; }",n+="div.container { background-color: "+e+"; }",n+="p."+t.id+".cacc-message { background-color: "+e+"; }",n+="p."+t.id+".cacc-message.cacc-text-invisible { color: "+e+"; }",f(t.node,n,"cacc-color-background")}function l(t,e){var i="svg."+t.id,n="";n+=i+" line { stroke: "+e+"; fill: "+e+"; }",n+=i+".cacc-text-monochrome text { stroke: "+e+"; fill: "+e+"; }",n+=i+" g#gridSVG text { stroke: "+e+"; fill: "+e+"; }",n+="div.container { color: "+e+"; }",n+="p."+t.id+".cacc-message { color: "+e+"; }",n+="ul."+t.id+".cacc-controls { color: "+e+"; }",n+=i+" polyline { stroke: "+e+"; fill: "+e+"; }",n+=i+" polygon { stroke: "+e+"; fill: "+e+"; }",n+=i+" path { stroke: "+e+"; fill: "+e+"; }",n+=i+" rect { stroke: "+e+"; fill: "+e+"; }",n+=i+" circle { stroke: "+e+"; fill: "+e+"; }",f(t.node,n,"cacc-color-elements")}function h(t,e,i){var n=document.createElement("style");n.setAttribute("class",i),n.innerHTML=e,t.appendChild(n)}function p(t,e){var i=t.querySelector("style."+e);return!!i&&(t.removeChild(i),!0)}function f(t,e,i){p(t,i),h(t,e,i)}e.documentCmlStyle=function(){document.body&&h(document.body,"div.cml { display:none; }","cacc-cml")},e.toggleTextVisibility=function(t){n.classList.toggle(t,"cacc-text-invisible")},e.toggleMonochrome=function(t){n.classList.toggle(t,"cacc-text-monochrome")},e.colorSchemes_=[{frgd:"#000",bkd:"#fff",active:"#fd6",almost:"#6df"},{frgd:"#fff",bkd:"#000",active:"#fd6",almost:"#6df"},{frgd:"#3C3",bkd:"#000",active:"#fd6",almost:"#6df"},{frgd:"#ee0",bkd:"#00e",active:"#4f4",almost:"#e3e"}],e.getScheme_=o,e.moleculeStyle=function(t){a(t),r(t,0)},e.pickScheme=r,e.nodeBackgroundStyle_=s,e.svgBaseStyle_=a,e.svgHighlightStyle_=c,e.svgBackgroundStyle_=u,e.svgForegroundStyle_=l,e.addStyle_=h,e.removeStyle_=p,e.replaceStyle_=f},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractMagnifier=void 0;var n=i(1),o=function(){function t(t){this.magnifier=t,this.activeElement=null,this.active_=!1,this.internalEvents_=[],this.viewBox=this.magnifier.viewBox,this.setupControls()}return t.prototype.isActive=function(){return this.active_},t.prototype.toggle=function(){return this.isActive()?this.deactivate_():this.activate_(),this.isActive()},t.prototype.registerEvent=function(t,e,i){this.internalEvents_.push(new n.CustomEvent(t,e,i))},t.prototype.addEvents=function(){for(var t,e=0;t=this.internalEvents_[e];e++)t.add()},t.prototype.removeEvents=function(){for(var t,e=0;t=this.internalEvents_[e];e++)t.remove()},t.prototype.setupControls=function(){},t.prototype.addControls=function(){},t.prototype.removeControls=function(){},t.prototype.update=function(t){this.activeElement=t,this.viewBox.select(this.activeElement.getDrawnElements())},t.prototype.activate_=function(){this.active_=!0,this.addControls(),this.addEvents(),this.viewBox.zoom("cacc-active")},t.prototype.deactivate_=function(){this.removeEvents(),this.removeControls(),this.viewBox.reset(),this.active_=!1},t}();e.AbstractMagnifier=o},function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.NeighbourHood=void 0;var r=i(0),s=i(24),a=i(25),c=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.neighbourhood=[],n}return o(e,t),e.prototype.complete=function(){t.prototype.complete.call(this),this.down.sort((function(t,e){return t.position-e.position}));for(var e=this.getAnnotation().querySelectorAll("neighbours neighbour"),i=0,n=void 0;n=e[i];i++)this.neighbourhood.push(new a.Neighbour(this,n))},e.prototype.getSpeech=function(){return this.getDiagram().translate(this.getMessage())},e.prototype.getMessage=function(){if(r.EXPERT_MODE){var t=r.getAttribute(this.getAnnotation(),"speech2");if(t)return t}return r.getAttribute(this.getAnnotation(),"speech")},e.prototype.getNeighbours=function(){return this.neighbourhood},e}(s.ChemObj);e.NeighbourHood=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractExplorer=void 0;var n=i(2),o=i(3),r=i(1),s=function(){function t(t){this.explorer=t,this.active_=!1,this.internalEvents_=[],this.molecule=t.molecule,this.message=this.setupMessage(),this.activeElement=this.molecule.cmlStructure.getRootElement(),this.addMessage(),this.setupControls(),this.registerMessageToggler_()}return t.prototype.isActive=function(){return this.active_},t.prototype.activate=function(){this.isActive()||(this.updateMessage(this.activeElement.getSpeech()),this.explorer.magnifier.magnifier.update(this.activeElement),this.addControls(),this.addEvents(),this.toggleActive_())},t.prototype.deactivate=function(){this.isActive()&&(this.removeEvents(),this.removeControls(),this.removeMessage(),this.explorer.magnifier.viewBox.reset(),this.toggleActive_())},t.prototype.registerEvent=function(t,e,i){this.internalEvents_.push(new r.CustomEvent(t,e,i))},t.prototype.addEvents=function(){for(var t,e=0;t=this.internalEvents_[e];e++)t.add()},t.prototype.removeEvents=function(){for(var t,e=0;t=this.internalEvents_[e];e++)t.remove()},t.prototype.setupMessage=function(){var t=this.molecule.createElement("p");return t.classList.add("explorer"),t.setAttribute("aria-live","assertive"),t.setAttribute("tabindex","-1"),t.classList.add("cacc-message"),n.Base.config.MSG_VISIBLE||t.classList.add("cacc-text-invisible"),t},t.prototype.addMessage=function(){this.molecule.node.parentNode.appendChild(this.message)},t.prototype.removeMessage=function(){this.message.textContent=""},t.prototype.updateMessage=function(t){this.message.textContent=t},t.prototype.setupControls=function(){},t.prototype.addControls=function(){},t.prototype.removeControls=function(){},t.prototype.toggleMessageVisibility_=function(){o.toggleTextVisibility(this.message)},t.prototype.toggleActive_=function(){this.active_=!this.active_},t.prototype.registerMessageToggler_=function(){this.registerEvent(this.molecule.node,r.EventType.KEYDOWN,function(t){return t.keyCode===r.KeyCodes.Z&&this.toggleMessageVisibility_(),t.stopPropagation(),!1}.bind(this))},t}();e.AbstractExplorer=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Base=void 0;var n=i(2);e.Base=n.Base},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Explorer=void 0;var n=i(0),o=i(3),r=i(1),s=i(9),a=i(16),c=i(17),u=function(){function t(t){this.explorer_=null,this.scheme=0,this.molecule=t,this.explorerPool=[new a.KeyExplorer(this),new c.MenuExplorer(this)],this.magnifier=new s.Magnifier(this),this.addExplorerActivation(),this.addColourControls()}return t.prototype.addExplorerActivation=function(){new r.CustomEvent(this.molecule.node,r.EventType.KEYDOWN,function(t){if(this.explorer_&&t.keyCode===r.KeyCodes.ESC&&(this.explorer_.deactivate(),this.explorer_=null),!this.explorer_)for(var e=0,i=void 0;i=this.explorerPool[e];e++)if(t.keyCode===i.getActivationKey()){i.activate(),this.explorer_=i,t.preventDefault();break}return t.stopPropagation(),!1}.bind(this)).add()},t.prototype.addColourControls=function(){for(var t=0,e=void 0;e=this.explorerPool[t];t++)e.registerEvent(this.molecule.node,r.EventType.KEYDOWN,function(t){switch(t.keyCode){case r.KeyCodes.T:o.toggleMonochrome(this.molecule.svg);break;case r.KeyCodes.C:o.pickScheme(this.molecule,++this.scheme);break;case r.KeyCodes.X:n.toggleExpertMode(),this.explorer_&&this.explorer_.updateMessage(this.explorer_.activeElement.getSpeech());break;case r.KeyCodes.L:this.molecule.cmlStructure.getMap().nextLanguage()&&this.explorer_&&this.explorer_.updateMessage(this.explorer_.activeElement.getSpeech())}return t.stopPropagation(),!1}.bind(this))},t}();e.Explorer=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Magnifier=void 0;var n=i(1),o=i(2),r=i(10),s=i(11),a=i(12),c=i(14),u=function(){function t(t){this.explorer=t,this.viewBox=new c.ViewBox(this.explorer.molecule.svg),this.dummy_=new r.DummyMagnifier(this),this.magnifier=this.dummy_,this.magnifierPool_=[new s.SimpleMagnifier(this),new a.StepMagnifier(this)],o.Base.config.MAG_ACTIVE&&(this.magnifier=this.magnifierPool_[1],this.magnifier.toggle()),this.addMagnifierActivation()}return t.prototype.addMagnifierActivation=function(){for(var t=this.magnifierPool_.map(function(t){return function(e){return e.keyCode===t.getActivationKey()&&(this.magnifier!==t&&this.magnifier.toggle(),this.magnifier=t.toggle()?t:this.dummy_),e.stopPropagation(),!1}.bind(this)}.bind(this)),e=function(e,o){t.forEach(function(t){o.registerEvent(this.explorer.molecule.node,n.EventType.KEYDOWN,t)}.bind(i))},i=this,o=0,r=void 0;r=this.explorer.explorerPool[o];o++)e(0,r)},t}();e.Magnifier=u},function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.DummyMagnifier=void 0;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.getActivationKey=function(){return null},e}(i(4).AbstractMagnifier);e.DummyMagnifier=r},function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.SimpleMagnifier=void 0;var r=i(1),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.update=function(t){this.activeElement=t,this.viewBox.select(this.activeElement.getDrawnElements()),this.viewBox.zoom("cacc-active")},e.prototype.timedUpdate=function(t){this.activeElement&&this.viewBox.select(t.getDrawnElements(),"cacc-almost"),setTimeout(function(){this.activeElement=t,this.viewBox.select([],"cacc-almost"),this.viewBox.select(this.activeElement.getDrawnElements(),"cacc-active")}.bind(this),2e3)},e.prototype.getActivationKey=function(){return r.KeyCodes.M},e}(i(4).AbstractMagnifier);e.SimpleMagnifier=s},function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.StepMagnifier=void 0;var r=i(13),s=i(1),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sonify=!1,e}return o(e,t),e.prototype.update=function(t){var e=this.activeElement?this.activeElement.getDrawnElements():[];this.viewBox.select(t.getDrawnElements(),"cacc-almost"),this.viewBox.select(t.getDrawnElements().concat(e),"cacc-dummy"),this.activeElement=t,this.viewBox.zoom("cacc-dummy",{duration:250,delay:25,wait:300,callback:function(){this.sonify&&r.Sonify.sonify(this.activeElement),this.viewBox.select([],"cacc-almost"),this.viewBox.select(this.activeElement.getDrawnElements(),"cacc-active"),this.viewBox.zoom("cacc-active",{duration:250,delay:25,wait:300})}.bind(this)})},e.prototype.getActivationKey=function(){return s.KeyCodes.N},e}(i(4).AbstractMagnifier);e.StepMagnifier=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Sonify=void 0;var n=i(0),o=function(){function t(t){this.path=[],this.points=[],this.context=new AudioContext,this.prepare(t),this.sonifiable=this.path.length}return t.sonify=function(e){var i=e.getAnnotation().querySelectorAll("sonification > *"),o=[];i.length&&(o=Array.from(i).map(function(t){var i=n.getTextContent(t),o=i+("ACTIVE"!==t.tagName&&"sre:active"!==t.tagName?"":i===e.getId()?e.getParent():e.getId());return e.getDiagram().get(o)}.bind(this)));var r=new t(o);r.sonifiable&&r.sonify()},t.prototype.prepare=function(t){for(var e=0,i=void 0;i=t[e];e++)if(i.getDrawnElement()){for(var n=i.getDrawnElement().querySelectorAll("polyline,path"),o=0;o<n.length;o++){var r=n[o];this.path.push(r);for(var s=0;s<r.points.length;s++)this.points.push([r.points[s].x,r.points[s].y])}for(n=i.getDrawnElement().querySelectorAll("rect"),o=0;o<n.length;o++)r=n[o],this.path.push(r),this.points.push([r.x.animVal.value,r.height.animVal.value?r.y.animVal.value+r.height.animVal.value:0])}},t.prototype.sonify=function(){for(var e=0;e<this.points.length;e++){var i=this.context.createOscillator();i.frequency.value=this.points[e][1]?t.BASE_FREQUENCY+10*this.points[e][1]:0,i.type="sine",i.connect(this.context.destination);var n=void 0,o=void 0;this.points.length>20?(n=e/10+.01,o=e/10+.1):(n=e/2+.01,o=e/2+.5),i.start(this.context.currentTime+n),i.stop(this.context.currentTime+o)}},t.prototype.smooth=function(){if(this.points.length){for(var e=[this.points[0]],i=0;i<this.points.length-1;i++){for(var n=this.points[i][0],o=this.points[i][1],r=this.points[i+1][0],s=this.points[i+1][1],a=Math.abs(n-r)/t.SMOOTH_VALUE,c=Math.abs(o-s)/t.SMOOTH_VALUE,u=Math.sign(s-o),l=1;l<t.SMOOTH_VALUE;l++)e.push([n+l*a,o+u*l*c]);e.push([r,s])}this.points=e}},t.BASE_FREQUENCY=300,t.SMOOTH_VALUE=4,t}();e.Sonify=o},function(t,e,i){"use strict";var n=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,r=i.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return s};Object.defineProperty(e,"__esModule",{value:!0}),e.ViewBox=e.ZoomOptions=void 0;var r=i(0),s=i(15);e.ZoomOptions=function(){};var a=function(){function t(t){this.svg=t,this.focusgroups=new Map,this.defaultZoomOptions={xPad:this.svg.width.baseVal.value/5,yPad:this.svg.height.baseVal.value/5,duration:100,delay:10,wait:0,callback:function(){}},this.reset()}return t.prototype.reset=function(){this.setViewBox_(s.Bbox.fromSvgRect(this.svg.getBBox()))},t.prototype.setClass=function(t,e){for(var i=0;i<t.length;i++)r.classList.add(t[i],e)},t.prototype.clearClass=function(t,e){for(var i=0;i<t.length;i++)r.classList.remove(t[i],e)},t.prototype.clearActive=function(){var t,e;try{for(var i=n(this.focusgroups),r=i.next();!r.done;r=i.next()){var s=o(r.value,2),a=s[0],c=s[1];this.clearClass(c,a)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}this.focusgroups.clear()},t.prototype.select=function(t,e){var i=e||"cacc-active",n=this.focusgroups.get(i);n&&this.clearClass(n,i),this.setClass(t,i),this.focusgroups.set(i,t)},t.prototype.zoom=function(t,e){var i=this.focusgroups.get(t);i&&0!==i.length&&this.setViewBox_(s.Bbox.combineBboxes(i),e)},t.prototype.setViewBox_=function(t,e){for(var i=this.completeZoomOptions_(e),n=this.retrieveViewBox_(),o=t.difference(n,i.xPad,i.yPad),r=Math.ceil(i.duration/i.delay),s=o.scale(1/r),a=function(t){return function(){this.svg.setAttribute("viewBox",n.add(s.scale(t)).viewBoxValue())}.bind(this)}.bind(this),c=1;c<=r;c++)setTimeout(a(c),c*i.delay);i.callback&&setTimeout(i.callback,i.wait+i.duration)},t.prototype.completeZoomOptions_=function(t){return t?Object.assign({},this.defaultZoomOptions,t):this.defaultZoomOptions},t.prototype.retrieveViewBox_=function(){try{return s.Bbox.fromSvgViewBox(this.svg.viewBox)}catch(t){return new s.Bbox(0,0,0,0)}},t}();e.ViewBox=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Bbox=void 0;var n=function(){function t(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}return t.fromSvgRect=function(e){return new t(e.x,e.y,e.width,e.height)},t.fromSvgViewBox=function(e){return new t(e.baseVal.x,e.baseVal.y,e.baseVal.width,e.baseVal.height)},t.combineBboxes=function(e){var i=function(t){var e=t.getBBox();if(0===e.x&&0===e.y&&0===e.width&&0===e.height&&t.childNodes&&t.childNodes[0]&&t.childNodes[0].transform){var i=t.childNodes[0],n=void 0,o=void 0,r=void 0,s=void 0;if(i.x&&i.y&&i.width&&i.height)n=i.x.baseVal.value,o=i.y.baseVal.value,r=i.width.baseVal.value,s=i.height.baseVal.value;else{var a=i.getBBox();n=a.baseVal.x,o=a.baseVal.y,r=a.baseVal.width,s=a.baseVal.height}var c=t.ownerSVGElement.createSVGPoint(),u=i.transform.baseVal;c.x=n,c.y=o;for(var l=u.length-1;l>=0;l--)c=c.matrixTransform(u.getItem(l).matrix);e.x=c.x,e.y=c.y,e.width=r,e.height=s}return e},n=t.fromSvgRect(i(e[0]));return 1===e.length?n:e.slice(1).reduce((function(t,e){return t.combine(i(e))}),n)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.width+e.width,this.height+e.height)},t.prototype.difference=function(t,e,i){var n=this.add(t.scale(-1));return e&&(n.x=n.x-e/2,n.width=n.width+e),i&&(n.y=n.y-i/2,n.height=n.height+i),n},t.prototype.scale=function(e){return new t(this.x*e,this.y*e,this.width*e,this.height*e)},t.prototype.combine=function(e){var i=Math.min(this.x,e.x),n=Math.min(this.y,e.y);return new t(i,n,Math.max(this.x+this.width,e.x+e.width)-i,Math.max(this.y+this.height,e.y+e.height)-n)},t.prototype.viewBoxValue=function(){return this.x+" "+this.y+" "+this.width+" "+this.height},t}();e.Bbox=n},function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.KeyExplorer=void 0;var r=i(1),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.setupControls=function(){var t=function(t,e){var i=e();i.length>0&&(this.activeElement=i[0],this.updateMessage(this.activeElement.getSpeech()),this.explorer.magnifier.magnifier.update(this.activeElement)),t.preventDefault()}.bind(this);this.registerEvent(this.molecule.node,r.EventType.KEYDOWN,function(e){switch(e.keyCode){case r.KeyCodes.DOWN:case r.KeyCodes.D:t(e,function(){return this.activeElement.getDown()}.bind(this));break;case r.KeyCodes.UP:case r.KeyCodes.E:t(e,function(){return this.activeElement.getUp()}.bind(this));break;case r.KeyCodes.RIGHT:case r.KeyCodes.F:t(e,function(){return this.activeElement.getRight()}.bind(this));break;case r.KeyCodes.LEFT:case r.KeyCodes.S:t(e,function(){return this.activeElement.getLeft()}.bind(this))}return e.stopPropagation(),!1}.bind(this))},e.prototype.removeControls=function(){this.explorer.magnifier.viewBox.clearActive()},e.prototype.getActivationKey=function(){return r.KeyCodes.A},e}(i(6).AbstractExplorer);e.KeyExplorer=s},function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.MenuExplorer=void 0;var r=i(1),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.setupControls=function(){var t=this.molecule.createElement("ul");t.classList.add("cacc-controls"),t.setAttribute("role","navigation"),this.control_=t;var e=function(t,e){var i=e();i.length>0&&(this.activeElement=i[0],this.updateMessage(this.activeElement.getSpeech()),this.explorer.magnifier.magnifier.update(this.activeElement))}.bind(this),i=function(t,i){this.registerEvent(t,r.EventType.KEYDOWN,(function(t){return t.keyCode!==r.KeyCodes.ENTER&&t.keyCode!==r.KeyCodes.SPACE||(e(t,i),t.preventDefault(),t.stopPropagation()),!1})),this.registerEvent(t,r.EventType.CLICK,(function(t){return e(t,i),t.stopPropagation(),!1}))}.bind(this);i(this.makeButton_("Down",t),function(){return this.activeElement.getDown()}.bind(this)),i(this.makeButton_("Up",t),function(){return this.activeElement.getUp()}.bind(this)),i(this.makeButton_("Right",t),function(){return this.activeElement.getRight()}.bind(this)),i(this.makeButton_("Left",t),function(){return this.activeElement.getLeft()}.bind(this))},e.prototype.addControls=function(){var t=this.molecule.node.querySelector(".cacc-message");t?this.molecule.node.insertBefore(this.control_,t):this.molecule.node.appendChild(this.control_)},e.prototype.removeControls=function(){this.explorer.magnifier.viewBox.clearActive(),this.control_.parentNode.removeChild(this.control_)},e.prototype.getActivationKey=function(){return r.KeyCodes.B},e.prototype.makeButton_=function(t,e){var i=this.molecule.createElement("li");return i.setAttribute("role","button"),i.setAttribute("aria-controls",this.message.getAttribute("id")),i.classList.add("cacc-button"),i.setAttribute("tabindex","0"),i.setAttribute("title",t),i.appendChild(document.createTextNode(t)),e.appendChild(i),i},e}(i(6).AbstractExplorer);e.MenuExplorer=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Molecule=void 0;var n=i(0),o=i(19),r=function(){function t(t,e,i){this.node=t,this.svg=e,this.cml=i,this.id=n.getId(),n.classList.add(this.svg,this.id),n.classList.add(this.cml,this.id),this.cmlStructure=new o.CML(this.cml),this.topLevelDescription=this.cmlStructure.getRootElement().getSpeech(),this.combine_()}return t.prototype.createElement=function(t){var e=document.createElement(t);return e.classList.add(this.id),e},t.prototype.combine_=function(){this.cmlStructure.getMap().forEach(function(t){var e=this.svg.getElementById(t.getId());e&&t.setDrawnElement(e)}.bind(this))},t}();e.Molecule=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CML=void 0;var n=i(20),o=i(21),r=i(23),s=i(27),a=i(28),c=function(){function t(t){this.cmlDocument=t,this.root=null,this.map=new n.Diagram(o.Languages.createLanguages(t)),this.initMap_()}return t.prototype.getMap=function(){return this.map},t.prototype.getRootElement=function(){return this.root||(this.root=this.map.find((function(t){return!(t instanceof a.Bond||t.up)}))),this.root},t.prototype.initMap_=function(){for(var t=this.cmlDocument.querySelectorAll("annotations > annotation"),e=0,i=void 0;i=t[e];e++){var n=i.firstElementChild;if(n){var o=void 0;switch(n.localName.toLowerCase()){case"atom":case"active":o=new r.Atom(i,this.map),this.map.set(o.getKey(),o);break;case"bond":case"passive":o=new a.Bond(i,this.map),this.map.set(o.getId(),o);break;case"atomset":case"grouped":o=new s.AtomSet(i,this.map),this.map.set(o.getId(),o)}}}this.map.forEach(function(t){t.complete()}.bind(this))},t}();e.CML=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Diagram=void 0;var n=function(){function t(t){this.diagram_={},this.languages_=t}return t.prototype.set=function(t,e){this.diagram_[t]=e},t.prototype.get=function(t){return this.diagram_[t]},t.prototype.forEach=function(t){for(var e in this.diagram_)t.call(this,this.diagram_[e])},t.prototype.find=function(t){for(var e in this.diagram_){var i=this.diagram_[e];if(t.call(this,i))return i}return null},t.prototype.translate=function(t){return this.languages_?this.languages_.translate(t):t},t.prototype.nextLanguage=function(){return this.languages_?(this.languages_.nextLanguage(),this.languages_.active):null},t}();e.Diagram=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Languages=void 0;var n=i(22),o=function(){function t(t){this.cmlDocument=t,this.languages={},this.insertLanguages(),this.active=this.defaultActive()}return t.createLanguages=function(e){return 0===e.querySelectorAll("messages").length?null:new t(e)},t.prototype.insertLanguages=function(){for(var t=this.cmlDocument.querySelectorAll("messages"),e=0,i=void 0;i=t[e];e++){var o=i.querySelector("language");o&&(this.languages[o.textContent]=new n.Language(i))}},t.prototype.defaultActive=function(){return this.languages.en?"en":Object.keys(this.languages)[0]},t.prototype.translate=function(t){return this.languages[this.active].translate(t)},t.prototype.nextLanguage=function(){var t=Object.keys(this.languages),e=t.indexOf(this.active)+1;this.active=t.length>e?t[e]:t[0]},t}();e.Languages=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Language=void 0;var n=i(0),o=function(){function t(t){this.cmlDocument=t,this.messages={},this.language=this.getLanguage(),this.insertMessages()}return t.prototype.getLanguage=function(){var t=this.cmlDocument.querySelector("language");return t?t.textContent:""},t.prototype.insertMessages=function(){for(var t=this.cmlDocument.querySelectorAll("message"),e=0,i=void 0;i=t[e];e++)this.messages[n.getAttribute(i,"msg")]=i.textContent},t.prototype.translate=function(t){return this.messages[t]},t}();e.Language=o},function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Atom=void 0;var r=i(0),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speech="",e}return o(e,t),e.prototype.getSpeech=function(){if(this.link){var t=this.getUpperNeighbour_(),e=t?t.getSpeech():"",i=[];return this.neighbourhood.forEach((function(t){"external"!==t.location&&i.push(t.getSpeech())})),this.speech=e+" "+i.join(" "),this.speech}var n=this.neighbourhood.map((function(t){return t.getSpeech()})).join(" "),o=this.getMessage();return this.speech=this.getDiagram().translate(o)+" "+n,this.speech},e.prototype.getDrawnElements=function(){if(this.drawnElements)return this.drawnElements;this.drawnElements=[];var t=this.getDrawnElement();t&&this.drawnElements.push(t);for(var e=this.getAnnotation().querySelectorAll("component *"),i=0;i<e.length;i++)(t=this.getDiagram().get(r.getTextContent(e[i])).getDrawnElement())&&-1===this.drawnElements.indexOf(t)&&this.drawnElements.push(t);return this.drawnElements},e.prototype.getUpperNeighbour_=function(){for(var t=0,e=void 0;e=this.up.neighbourhood[t];t++)if(-1!==e.via().map((function(t){return t.getPosition()})).indexOf(this.position))return e;return null},e}(i(5).NeighbourHood);e.Atom=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChemObj=void 0;var n=i(0),o=function(){function t(t,e){this.annotation_=t,this.diagram_=e,this.drawnElements=null,this.up=null,this.down=[],this.link=!1,this.drawn_=null,this.id_=this.getId_(),this.parent_=this.getParent_(),this.position=this.getPosition_()}return t.prototype.getAnnotation=function(){return this.annotation_},t.prototype.getDiagram=function(){return this.diagram_},t.prototype.getId=function(){return this.id_},t.prototype.setDrawnElement=function(t){this.drawn_=t},t.prototype.getDrawnElement=function(){return this.drawn_},t.prototype.getDrawnElements=function(){return this.drawnElements||(this.drawnElements=[],this.drawn_&&this.drawnElements.push(this.drawn_)),this.drawnElements},t.prototype.complete=function(){if(this.parent_){var t=this.getDiagram().get(this.parent_);this.up=t,t.down.push(this)}},t.prototype.getParent=function(){return this.parent_},t.prototype.getKey=function(){return this.id_+this.parent_},t.prototype.getUp=function(){return this.up?[this.up]:[]},t.prototype.getDown=function(){return this.down},t.prototype.getRight=function(){if(!this.up)return[];var t=this.up.getDown(),e=t.indexOf(this);if(t.length>e+1){var i=t[e+1];return i.position?[i]:[]}return[]},t.prototype.getLeft=function(){if(!this.up)return[];var t=this.up.getDown(),e=t.indexOf(this);if(e>0){var i=t[e-1];return i.position?[i]:[]}return[]},t.prototype.getId_=function(){var t=this.getAnnotation().firstElementChild;return t?t.textContent:""},t.prototype.getParent_=function(){var t=this.getAnnotation().querySelector("parents > *");return t?n.getTextContent(t):""},t.prototype.getPosition_=function(){return parseInt(n.getTextContent(this.getAnnotation().querySelector("position")),10)},t}();e.ChemObj=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Neighbour=void 0;var n=i(0),o=i(26),r=function(){function t(t,e){this.from_=t,this.annotation_=e,this.speech=null,this.speech2=null;var i=n.children(this.annotation_);this.to_=this.from_.getDiagram().get(n.getTextContent(i[0])),this.via_=i.slice(1).map(function(t){return new o.Via(this,t)}.bind(this)),this.location=this.annotation_.getAttribute("sre:location")||""}return t.prototype.from=function(){return this.from_},t.prototype.to=function(){return this.to_},t.prototype.via=function(){return this.via_},t.prototype.getSpeech=function(){return this.from_.getDiagram().translate(this.getMessage())},t.prototype.getMessage=function(){if(n.EXPERT_MODE){if(this.speech2)return this.speech2;if(this.speech2=n.getAttribute(this.annotation_,"speech2"),this.speech2)return this.speech2}return this.speech||(this.speech=n.getAttribute(this.annotation_,"speech")),this.speech},t}();e.Neighbour=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Via=void 0;var n=i(0),o=function(){function t(t,e){this.neighbour_=t,this.annotation_=e,this.type_=n.getAttribute(this.annotation_,"type");var i=n.children(this.annotation_);this.connectedBy_=this.getConnectedBy_(i[0]),this.connectedBy_.link=!0,this.position_=parseInt(n.getTextContent(i[1]),10)}return t.prototype.getDrawnElements=function(){return this.connectedBy_.getDrawnElements()||[]},t.prototype.getType=function(){return this.type_||""},t.prototype.getPosition=function(){return this.position_},t.prototype.getConnectedBy_=function(t){var e=this.neighbour_.from().getDiagram(),i=n.getTextContent(t);return e.get(i)||e.get(i+this.neighbour_.from().getId())},t}();e.Via=o},function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.AtomSet=void 0;var r=i(0),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.getDrawnElements=function(){if(this.drawnElements)return this.drawnElements;this.drawnElements=[];var t={},e=function(e){t[e.id]||(t[e.id]=!0,this.drawnElements.push(e))},i=this.getDrawnElement();i&&e(i);for(var n=0,o=void 0;o=this.getDown()[n];n++)o.getDrawnElements().forEach(e.bind(this)),(i=o.getDrawnElement())&&e(i);var s=this.getAnnotation().querySelectorAll("component bond,passive");for(n=0;n<s.length;n++){var a=r.getTextContent(s[n]);(o=this.getDiagram().get(a)).getDrawnElements().forEach(e.bind(this)),(i=o.getDrawnElement())&&e(i)}return this.drawnElements},e}(i(5).NeighbourHood);e.AtomSet=s},function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Bond=void 0;var r=i(0),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ends=[],e}return o(e,t),e.prototype.complete=function(){for(var t=this.getAnnotation().querySelectorAll("component > atom,active"),e=0,i=void 0;i=t[e];e++){var n=this.getDiagram().get(r.getTextContent(i));n&&this.ends.push(n)}},e}(i(5).NeighbourHood);e.Bond=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.fromUri_=e.getUrlParameters_=e.getParam_=e.getData_=e.getMol_=e.forDocument=void 0;var n=i(30);function o(t){t.querySelector("div.svg")?(t.setAttribute("has-svg","true"),n.rewriteTransformations(t.querySelector("div.svg > svg"))):r(t,"svg","data-src",".svg"),t.querySelector("div.cml")?t.setAttribute("has-cml","true"):r(t,"cml","data-cml",".xml")}function r(t,e,i,o){var r=t.getAttribute(i)||s(t,i,o);r?c(r,(function(i){if(i){t.setAttribute("has-"+e,"true");var o=document.createElement("div");o.classList.add(e),o.setAttribute("aria-hidden","true"),"svg"===e&&n.rewriteTransformations(i),o.appendChild(i.documentElement),t.appendChild(o)}else t.setAttribute("has-"+e,"false")})):t.setAttribute("has-"+e,"false")}function s(t,e,i){if(!t.id)return null;var n=a()[t.id];return n?(n+=i,t.setAttribute(e,n),n):null}function a(){for(var t,e={},i=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<i.length;n++)e[(t=i[n].split("="))[0]]=t[1];return e}function c(t,e){if("file:"!==location.protocol){var i=new DOMParser,n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&200===n.status&&e(i.parseFromString(n.responseText,"text/xml"))},n.open("GET",t,!0),n.send(null)}else e(null)}e.forDocument=function(t){for(var e=t||document,i=Array.from(e.querySelectorAll(".ChemAccess-element")),n={},r=0,s=void 0;s=i[r];r++)o(s),s.id||(s.id="ChemAccess-element"+r),n[s.id]=s;return n},e.getMol_=o,e.getData_=r,e.getParam_=s,e.getUrlParameters_=a,e.fromUri_=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.transformNodes=e.purgeTransforms=e.envelopNode=e.transformNode=e.rewriteTransformations=void 0;var n=i(0);function o(t){var e=t,i=[];do{var n=e.getAttribute("transform");n&&i.unshift(n),e=e.parentNode}while("svg"!==e.tagName);return t.setAttribute("transform",i.join(" ")),t}function r(t){var e=document.createElementNS("http://www.w3.org/2000/svg","g"),i=t.getAttribute("id");return i&&(e.setAttribute("id",i),t.removeAttribute("id")),t.parentNode.replaceChild(e,t),e.appendChild(t),e}function s(t){var e=t;do{(e=e.parentNode).removeAttribute("transform")}while("svg"!==e.tagName)}function a(t){t.forEach(o),t.forEach(s),t.filter((function(t){return t.hasAttribute("id")})).forEach(r)}e.rewriteTransformations=function(t){var e=n.toArray(t.querySelectorAll("text,polyline,line,rect,polygon,use,path"));return a(e),e},e.transformNode=o,e.envelopNode=r,e.purgeTransforms=s,e.transformNodes=a}])}));</script>
 <script type="text/javascript">document.addEventListener("DOMContentLoaded",(function(){(new cacc.Base).init()}));</script>
 <script type="text/javascript">let slider=null;function getSlider(){return slider||(slider=document.querySelector(".slider"),slider)}function scrollToNextPage(){getSlider().scrollBy({top:0,left:1e3,behavior:"smooth"})}function scrollToPrevPage(){getSlider().scrollBy({top:0,left:-1e3,behavior:"smooth"})}function stopEvent(e){e.preventDefault&&-1!==navigator.userAgent.indexOf("Mozilla")?e.preventDefault():e.returnValue=!1,e.stopImmediatePropagation?e.stopImmediatePropagation():e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0}window.addEventListener("load",(function(e){document.body.addEventListener("keydown",(function(e){let t=e.keyCode;return 34===t||39===t||32===t?(scrollToNextPage(),stopEvent(e)):33!==e.keyCode&&37!==t||(scrollToPrevPage(),stopEvent(e))}));let t=document.querySelector(".btn.next");t&&t.addEventListener("click",scrollToNextPage);let o=document.querySelector(".btn.prev");o&&o.addEventListener("click",scrollToPrevPage)}));</script>
</head>
<body>

<h1 id="conversion-wrap-up-and-other-formats">Conversion wrap-up and Other Formats</h1>
<h1 id="dr.-volker-sorge"><a href="https://www.cs.bham.ac.uk/~vxs/index.php">Dr. Volker Sorge</a></h1>
<p><a href="http://htmlpreview.github.io/?https://github.com/zorkow/COV885/blob/main/lecture_07/index.html">Lecture slides</a></p>
<h1 id="overview">Overview</h1>
<p>Welcome back. What I want to do today is, first of all, I kind of given a loosely formulated homework last time, so I would like to see what people came up with, trying to tie up some of the ends with the math conversion and particular document conversion of math document for LaTeX and other sources. And then we are going to have a look at some of the other documents that we haven't really discussed, things coming from images, PDFs(generating PDFs), also talk tiny bit about EPUB files that will then kind of close on this major section of the lecture and then next lecture (tomorrow) will then start with graphics primarily' kind of artefacts and documents in particular stem documents.<br />
Okay! So, my 1st question is, to all of you, so has anybody had got a chance to look into the SVG formulas that I had posted, that were there on the repository! So have you had a time to Play around with it? If you have, would you like to share what you have done.<br />
What I said last time was, It is a good idea to just take SVG and add different kind of Tab indices, You change the order of the elements, around which you tab through… And so on… That kind of give you more of a feeling what you can do and in a particular what the flexibilities are with these structures.<br />
To the next one, has anybody looked into the maths documents which we have converted.<br />
- <a href="https://github.com/zorkow/COV885/raw/main/exercises/math_example/rademacher_2013-12-16.pdf">original PDF</a></p>
<ul class="incremental">
<li><a href="http://htmlpreview.github.io/?https://github.com/zorkow/COV885/blob/main/exercises/math_example/rademacher_pd.html">pandoc conversion</a></li>
<li><a href="http://htmlpreview.github.io/?https://github.com/zorkow/COV885/blob/main/exercises/math_example/rademacher_mk.html">make4ht conversion</a></li>
</ul>
<p>Question:<br />
where are you going to put footnotes on a document which does not separated into pages. If you have no page breaks. I suppose the end of the document is as good as any. Similar to Wikipedia articles (references etcetera), all you have is at the end of the document. What do you think, Is it important for footnotes or references of that nature.<br />
In documents, it is always a good practice to having a back links for the references. It's pandoc which tries to include those back links.<br />
some of the points where bibliographies are missing, the referencing, footnotes, figures are broken etc.</p>
<h1 id="tweaking-converters-pandoc">Tweaking Converters: pandoc</h1>
<p>All of these things in many ways can be fixed. By working more diligently with conversion tools. Pandoc has many ways to tweak the converter. What is called "Pandoc Filters" which are effectively post processors. Which you can use in order to improve your output.</p>
<h2 id="github-search"><a href="https://github.com/topics/pandoc-filter">github search</a></h2>
<p>If we do a general search on github for pandoc filters you will come across more than 70 repositories.</p>
<h2 id="pandoc-crossref"><a href="https://github.com/lierdakil/pandoc-crossref">pandoc-crossref</a></h2>
<p>This will help you with cross-referencing. This is all for doing clever things with latex packages for clever referencing.</p>
<h2 id="pandoc-xnos"><a href="https://github.com/tomduck/pandoc-xnos">pandoc-xnos</a></h2>
<p>This is particularly used if you have equation numbering, referencing for equation numbering, table numbering, figure numbers etc. you get automatically links between these elements.</p>
<h2 id="mermaid-filter"><a href="https://github.com/raghur/mermaid-filter">mermaid-filter</a></h2>
<h2 id="lua-filters"><a href="https://github.com/pandoc/lua-filters">Lua filters</a></h2>
<p>pandoc supports lua filters.<br />
What are lua filters?<br />
Lua itself is a lightweight scripting language. Which is built on top of C or C++. The whole Paradigm of Lua is it allows you to do postprocessing on data structures, also intermediate postprocessing on data structures. With just few scripting markups.<br />
pandoc has entire collection of lua Filters. Which not only gives us a very easy way of including tiny scripts to just tweak the occasional command, or the output of the occasional latex command. But also allows us to create our own filters. For instance citations, short section referencing, for captioning, for all kinds of things.<br />
   pandoc –filter=PROGRAM …</p>
<p>All of these filters are there, that means you have to select what you want and then what are your needs of the particular document, depending on what packages authors have used, you might need different filters. There is a lot of potential for extensions. But it always has to do bit of research what you need for a particular document. For all of the issues that now you have identified in the document, there will be some sort of filter which can take care of it. Obviously there will be some documents which always be so complex and complicated that you might not find a yet another filter for it. Which solves all the problems.</p>
<h1 id="tweaking-converters-pmake4ht">Tweaking Converters: pmake4ht</h1>
<p>make4ht has advantage that you can use multiple backends.<br />
The one which is shown above<a href="http://htmlpreview.github.io/?https://github.com/zorkow/COV885/blob/main/exercises/math_example/rademacher_mk.html">make4ht conversion</a> is tex4ht which is effectively a backend which works with normal latex contribution. tex4ht is not that easy to tweak. Things like Texlive, dTeX, Miktex for windows…<br />
One in particular luatex, it has an idea of having a lua style scripting language built in, meaning you can easily enter commands in TeX, depending on what you need as a output.. It is a principal way to add a lightweight scripting to TeX, that can be particularly exploited for conversion using a backend for make4ht using lua4ht and luaTeX. (Postconversion filtering and processing for output)</p>
<h1 id="bibliographies-and-citations">Bibliographies and Citations</h1>
<p>In bibliographies and citations there is a very good tooling support.<br />
if you download <a href="https://github.com/zorkow/COV885/raw/main/exercises/math_example.zip">this zip file</a>, there is a bibliography file included, so if you could do the conversion by yourself, by means use the bibliography file and it should be included.<br />
  </p>
<p>\begin{bibliography}</p>
<ul class="incremental">
<li>Bibtex is generally ok.</li>
<li>Other tooling has less support (natbib, biblatex, biber)</li>
<li>citations should match cross-references and bibliography</li>
<li>Backlinks are good, and not just for accessibility, backlinks are always good.<br />
</li>
<li>pandoc adds backlinks automatically, <a href="https://tex.stackexchange.com/questions/521644/tex4ht-backref-option-of-hyperref-not-working-well">tex4ht</a> is not that well supported for backlinks.</li>
<li>advanced markup (DPUB ARIA, schema.org) not supported by conversion</li>
</ul>
<h1 id="cross-references.">Cross-references.</h1>
<p>Cross-referencing is the whole point for web. You want to reference everywhere and anywhere every time. In many ways referencing is a good thing. But it has to be done right. Sometimes authors particularly don't do it very well. Meaning they do all kinds of clever things such as abbreviations for references and that's one of things you have to get rid of it manually sometimes.<br />
For instance, never reference a range of elements. e.g. Reference 1 to 8, i.e.</p>
<pre><code>\ref{1} -- \ref{8}
</code></pre>
<h1 id="footnotes">Footnotes</h1>
<p>The best thing is always avoid footnotes. My general advice is if you put something in footnote think about how important it actually is,<br />
if something is really important for the understanding of the content then it shouldn't be in the footnotes. Even if there's just an explanation of abbreviation or something… In my opinion that should always be right in the text. In very very few occasions where you need footnote.<br />
There are certain citation styles, particularly in social sciences, where footnotes is kind of the main means of introducing citations. That obviously you will not really want on web. And if you do want it on web then we do Wikipedia style. That's pretty much main way to do it.</p>
<h1 id="indices-glossaries-appendices">Indices, Glossaries, Appendices</h1>
<p>Appendices are easy, they normally works like a sections. ARIA markup for appendices is usually not supported by convertors (but little impact in practice).<br />
Indices in the web documents are rarely used. If you want to do it, then you do more like a navigation element of that page. Normally web indices are on the left-hand side like a navigation bar.<br />
Glossaries in general, becomes very unfashionable, yes if you have a big book, for those instance glossaries are useful. But in most writings glossaries can easily outsourced. You rather use the power of web which is given to you like linking Wikipedia links etc.<br />
</p>
<h1 id="theorem-environments">Theorem Environments</h1>
<p>What are things like theorem environments and proof environments.<br />
Generally TeX converters do not treat these things very well. (just creating wrapping divs); Sometimes they do work when it is not nastily nested so post-processing might be feasible. But some authors and environments do nest it heavily then it becomes difficult.<br />
  QUOTE</sub> don't nest, don't abuse</p>
<p>what are they really? Landmarks?<br />
You should always think about these kind of environments in terms of what really they are. In many ways they are not much different than sections. a theorem is something which is kind of small paragraph with the heading, it's more something which you want to treate like landmark (with identifiable titles) and as you read any other section or paragraph or some other elements in a page. we lack a dedicated native solution, but can do e.g., section+heading, figure+figcaption, possibly with a role description.<br />
PreTeXt is a way to getting math document on to the web, particularly in open format. checkout <a href="https://github.com/oscarlevin/pandoc-pretext">pandoc-pretext</a><br />
amsthm advice for proofs: short = theorem, long = section<br />
e.g., don't do subclaims in proofs as theorems just because you like the styling</p>
<h1 id="algorithm-layout">Algorithm Layout</h1>
<p>In computer science books or articles, algorithm layout is something which is generally badly supported, when it comes to converting elements. There are various ways how to do this, for instance, one of system is <a href="https://prismjs.com/">prism js</a>, which allows you to include raw source code into html elements. Alternative solution is to do something with Markdown elements. Markdown elements gives you a nice way of including source code. My general advice, when it comes to converting content which contains lots of algorithms, try to identify where the algorithms are, get them out and put them in spoken environment or spoken system which can work with markdown. <a href="https://prismjs.com/">Prism js</a> is also one of them which actually allows you to easily work with these algorithm content.</p>
<h1 id="diagram-authoring">Diagram Authoring</h1>
<p>One of the things which we saw in our example document was… Some of the images didn't come across well… Some of the images either omitted… or they were at wrong size, all that has to do is of course with diagram authoring! But that's something which we will start tomorrow. How will make them accessible in particular.</p>
<h1 id="considerations-in-latex-authoring">Considerations in LaTeX Authoring</h1>
<p>If you are author yourself or if you also work with authors, want to educate authors in particular what is good and what is bad in terms of authoring, when you need to convert something into accessible format.<br />
In various American universities, where department puts together guidelines, for their staff and for their faculty in particular. How they should write their documents, what they should avoid in documents in order to make the life easier for those who sits in places where they have to convert it and make it accessible.<br />
</p>
<h2 id="tex-tips-what-to-do">TeX tips: what to do</h2>
<p>One of the classic advice is always try to pick common latex style. It's like a programming. There are so many ways how you can program and how you can structure your code well and how you can structure your code badly.<br />
</p>
<ul class="incremental">
<li><a href="https://en.wikibooks.org/wiki/LaTeX">Wikibook LaTeX</a></li>
<li><a href="https://texdoc.org/serve/latex2e.pdf/0">LaTeX 2e Unofficial Manual</a></li>
<li><a href="https://www.ams.org/publications/authors/AMS-StyleGuide-online.pdf">AMS Style Guide</a></li>
</ul>
<p>How you can document your code well and how you can leave your code entirely undocumented for instance. The same thing holds for latex. Hence there are plenty of style guides out there. There are all kinds of ways how to do standard sectioning, lists, figures, use labels and cross-reference them (\ref, \cite etc) And So on…<br />
   <span class="math inline">$\eqref$</span></p>
<p>can help with pass through.</p>
<h1 id="things-that-you-should-always-avoid-in-latex">Things that you should always avoid in latex</h1>
<ol class="incremental">
<li>plain TeX - LaTeX only please!</li>
<li>TeX programming (changing core macros, active characters, loops etc)</li>
<li><a href="https://mirror.clientvps.com/CTAN/info/l2tabu/english/l2tabuen.pdf">LaTeX taboos</a></li>
<li>box hackery, e.g., parbox, minipage, pbox, fbox, raisebox, rotatebox</li>
<li>Using real world page dimensions ( etc), Never use things such as inches millimetre centimetre. Always talk in terms of em and px, the relative size of your fonts. <a href="https://www.w3.org/Style/Examples/007/units.en.html">web style sheets CSS tips &amp; tricks</a></li>
<li>Avoid any manual spacing. particularly manual spacing inside Math elements. (\!, hspace, vspace, hfill)</li>
<li>manual positioning (cover pages, pgf drawing across page), Triggery with callers, hidden cross-referencing.</li>
<li>anything that hard codes line breaks, spacings, line length, white spacings etc. because if you want to go to flexible outline and flexible layout all of these things are just a nightmare to get rid of. And sometimes it just screwed up entire conversion process.</li>
<li>Custom counters and items. Where you change how the item looks like. Because all of these converters actually don't know how to deal with that.</li>
<li>In Math Mode: avoid too much mixing. You can mix text in math mode, but you can nest so deeply that ultimately it all breaks down. If you have text inside maths then who is going to render that.</li>
<li>Avoid punctuation near mathematical elements. Mathematicians love to do that but it's still a nightmare.</li>
</ol>
<h2 id="tex-tips-what-to-avoid">TeX tips: what to avoid</h2>
<ul class="incremental">
<li>color</li>
<li>rules-based constructs</li>
<li>generated pictures, pstricks, tikz</li>
<li>but standalone conversion can work</li>
<li>custom counters (e.g., lists)</li>
<li>custom items (\item[…])</li>
<li>hidden crossrefs (question mark question mark question mark–question mark question mark question mark etc.)</li>
<li>hardcoded linebreaks</li>
<li>hardcoded linelengths</li>
<li>hardcoded whitespace</li>
<li>avoid hacking layout using TeX (a little CSS goes a long way)</li>
</ul>
<h2 id="tips-for-math-mode">Tips for math mode</h2>
<ul class="incremental">
<li>custom macros: usually as pass-through, i.e build mathjax config or extension necessary</li>
<li>example: <a href="https://github.com/simurgh9/homework">sty file with mathjax extension</a></li>
<li>avoid mixing text and math mode, e.g., subequations, intertext etc.
<ul class="incremental">
<li>(complex) text mode inside math mode.</li>
<li>Parboxes etc inside math mode</li>
</ul></li>
<li>avoid large tables in math mode (consider tabular)</li>
<li>avoid long inline equations (no linebreaks)</li>
<li>auto aligned environments can surprise
<ul class="incremental">
<li>e.g., multline (without max-width on container)</li>
</ul></li>
<li>auto-numbering support varies</li>
<li>punctuation near math</li>
</ul>
<h1 id="authoring-for-the-web">Authoring for the Web</h1>
<ul class="incremental">
<li>Stop thinking "print only"
<ul class="incremental">
<li>You are no longer bound to a paper size</li>
<li>Spacing should be flexible, colors can change</li>
</ul></li>
<li>Reflow vs Pagination
<ul class="incremental">
<li>Do not assume pages for referencing, positioning, etc.</li>
<li>Graphics, tables, images might be in different positions</li>
</ul></li>
<li>Size really matters
<ul class="incremental">
<li>Content can be viewed on various form factors</li>
<li>Make sure it displays fine even on extreme zoom</li>
</ul></li>
<li>Remember: There might be more Than one output format</li>
</ul>
<p>Note: That does not mean we want you to change your authoring workflow!</p>
<h1 id="other-formats">Other Formats</h1>
<p>What we have done so far is effectively source to web, which in many ways is easy. First of all you got the source file, which gives you most information possible by the document, and you've got most currently available flexible canvas to paint or to draw on your document which is web.<br />
What about other sources, which might be harder. Sources as not necessarily authors sources as well as targets which are different on web.</p>
<h1 id="taxonomy-of-sources">Taxonomy of Sources</h1>
<p>The sources I wanna briefly go to in this part of lecture first one is normally called Retro-digitized. These are the sources which comes from originally printed material, then being digitised in some way, in order to make them available as a file or somewhere via the web. e.g. Scanned, images, electronic documents with scanned images.<br />
The second kind of taxonomy is born digital. Born digital means those are the documents which are actually generated from digital sources, however the source is no longer available to us.<br />
Finally Born Accessible documents are effective documents as we've seen them, we have the sources, or at least the documents are created in a way that they contain everything, that allows us to make them accessible.</p>
<h2 id="retro-digitized">Retro-digitized</h2>
<p>These are generally historical manuscripts runs of journals as well as old books etc. The way they are being sourced is usually through some sort of big organisation like a National library, or publishers do retro-digitised scanned things in a bigger rounds (Google books is also an example), and then make them available as some sort of electronic format. Most of the times these are single images or pdf containing single images of a digitised version.<br />
<a href="https://www.jstor.org/">JSTOR</a> is a classic system where you have a lot of old Retro-digitized documents. You can have directly access via account or there is also access to some of these via program for data research. Let's browse by subject, let's pick one of those mathematics journal, obviously all this is purely image even if you download it as a PDF. There is no content available for you to use. The question now is what you gonna do? If there is no content available for us to use? Well there is various ways to do these things, one common way is using optical character recognition(OCR) program. That means we go from image to some electronic representation, trying to find out where are the characters there, what are the words in a document, then simply try to put together the original content of the document which we have scanned. That is often very difficult, in particular historical documents. Therefore there are various ways not only automating that but also kind of try to proof read and add some corrections to the transcriptions. For instance there is a program called <a href="https://www.zooniverse.org/">Zooniverse</a>, it's a way in order to crowd source information from people primarily via identifying things in images but also transcribe the elements on pages of historical document. One of their flagship project was "weather chart from 1914 to 1980", via various scan sources of weather reports during World War I. And they currently have same for World War II. So there are weather reports which effectively huge tables containing data for every hour of the day at a particular vicinity in longitude and latitude, which is primarily gathered by submarines and different weather ships and so on. It was very successful for World War I. For World War II they are currently at 4%. Actually it will still take a while until people have transcribe that properly and corrected some of their recognition.</p>
<h1 id="what-about-math">What about Math</h1>
<p>One of the problems is that some of these systems works fairly well with regular text. Even when you buy a scanner you normally get a piece of software with that, which does basic OCR for you. It's particularly difficult for mathematical detection and why that is the case? well, because it's simply not just a regular text, there is a couple of artefacts which makes it difficult.<br />
First of all it's more difficult to find where math is in a scanned page, it is more difficult to analyse what the real layout of it is,<br />
you can analyse quite quickly what are single lines, you can analyse quite well what is paragraph, what is header, but finding out where the Math is, what's the size of maths, does it have a label, and then what is actual composition of mathematical element is very very difficult. That has not only to do with dictionaries where you can look things up. Which doesn't allow you to do some sort of secondary or higher order recognition, as you can do for normal texts, for the normal texts you can recognise characters, you can recognise distances between words and you might be able to find sentences, then you can have a higher order recognition running over that again and saying, Ok, well, if we know for an instance this particular piece of writing is in English, then I can start looking things on a dictionary, possibly cross compiling words, which might have errors in them, and thereby do some sort of error correction on particular characters which might have been mis-recognised. In mathematics that is practically impossible. Because there is no dictionaries. There's many different fonts. There's different scripts used… and so on…. All the usual problems, that already make things hard for us, to make things accessible. It's even worse when you talk about OCR.<br />
So What are the possibilities?<br />
</p>
<h1 id="ocr-systems">OCR Systems</h1>
<p>Well, There's bunch of generic OCR systems out there you can use. Which generally do not do good job.<br />
so the most commonly used is for instance <a href="https://pdf.abbyy.com/">Abby Fine Reader</a>, it's a proprietary system and it has support for some special fonts. germafactor fonts, black letter fonts or greek character sets as well as serelic fonts which are often used in math documents. However when it comes to complex layout of mathematics, it's not particularly accurate.<br />
<a href="https://github.com/tesseract-ocr/tesseract">Tesseract</a> which is now maintained by Google and was part of Google book project as well.<br />
Here is another system called <a href="https://en.wikipedia.org/wiki/GOCR">GOCR</a> which is easily available. Unfortunately it doesn't even get the header right. It's even worse.<br />
All of these are quite atrocious what you get as a result. You don't get any of the special characters recognised, so they are effectively unusable.<br />
What else can we do there,<br />
Well, there is one system out there, which has been developed for more than 20 years, actually specialised in Math OCR, that's called <a href="http://www.inftyproject.org/en/index.html">Infty</a>. Unfortunately Infty only runs on Windows.</p>
<ul class="incremental">
<li><a href="https://www.inftyreader.org/">Full document analysis</a></li>
</ul>
<p>they can produce all kinds of different output formats,e.g. TeX, IML (Infty Markup Language), XHTML. The one we are looking now is XHTML page, and XHTML page looks actually quite good, so, much text is in there, the math is there, the problem might, the math doesn't display is because it's XHTML in HTML browser. If we have look at those elements, these are actually Math ML elements, so if we check MathJax in the page it should actually looks quite nice. Obviously above document is the demo document they have on website, and reality is probably not quite as is as fantastic results.<br />
So this is one type of OCR system effectively working on full-page OCR systems. Other things you can have is, what I would refer as snapshotting.</p>
<h1 id="snapshotting">Snapshotting</h1>
<p>What is snapshotting ?<br />
The idea there is you kind of make a isolated observation of a particular element which you know is a mathematics. Crop that formula, then tried to do OCR from that. There are number of systems out there which do that.</p>
<ul class="incremental">
<li><a href="https://mathpix.com/">Mathpix Snip</a></li>
</ul>
<p>It gives me latex formula, translation from the original latex and that's actually pretty good. It recognised entire formula that we've just took from the page which we downloaded from the internet. This is really really nice page in a way! Because it's a well designed PDF document, which has clearly been compiled from latex. Let's have a look at older document, earlier document we've opened from JSTOR, let's try same thing, taking snapshot, and see what happens, what we get in terms of OCR and latex, so the formula for instance is pretty much there, but math symbol Chi recognised as a superscript theta, But otherwise everything seems quite alright.</p>
<ul class="incremental">
<li><p><a href="https://www.texthelp.com/products/equatio/">EquatIO</a></p>
<p>The nice thing about EquatIO is you can install it inside your browser environment. Meaning that you can now simply run EquatIO from web browser and it opens up a toolbar at the bottom of your screen. and now we can snip out one of these things,<br />
</p></li>
</ul>
<p>let's start with the easy one, it could read out so you can hear now, For those who can't see what we recognised on slides.<br />
Let's try with different document, again same trickery here. Let's do this, so it reads out nicely as well, so again that was all being done with the OCR.<br />
And let's now further final attempt, let's try one of those old paper from 1929, again let's get EquatIO going. Right! That recognised it quite well! With the one exception, that is, this is probably difficult to see, here is probably 6 it's not a small letter "b". But in general it recognised things quite well.<br />
Why it's easier to do in isolation? Because you know it's mathematics, you kind of concentrate on the layout exclusively, you don't have too worry much about the surrounding text.<br />
Now let's try with the surrounding text as well, now you notice that it has misrecognised.<br />
EquatIO has a free version which anybody can install, and then it has a premium version which allows you to do speech recognition and Speech input, I want to show you that next weak, some point in speech input.</p>
<h1 id="born-digital">Born Digital</h1>
<p>Born digital effectively means that you have the digital document which has been compiled from some source, but the sources are not available anymore or at least they are not available to you, and not available to you at that right moment where you need to find out something about document, i.e. making it accessible.<br />
The general use case is you have a PDF document which has been compiled from source, something like latex, word, something else, and now you want to make it accessible, unfortunately you don't get to the actual source, therefore you can't just convert, you need to somehow get to the things inside PDF document. Obviously that doesn't only apply for the PDF documents, but there's other document formats like Rich text format, which was proprietary format by Microsoft. They don't really supported anymore, because they've also moved towards PDF. Postscript is precursor to PDF, of course which was primarily for the printers only. but all of these can be converted pretty much losslessly to the PDF. All the content they contained can be converted into PDF.</p>
<p>What if PDF is the only source?<br />
Well, there is a couple of ways how to make it accessible. The easiest one is for instance, Acrobat Reader already offers you ways of just reading it out directly. And it often works with multiple screen readers, straight out of the box.<br />
There are ways of translating things inside browsers, for instance, ChromeVox is used often to integrate, which simply transforms PDF in some sort of web document.<br />
Now the problem is, of course is usual, most of these tools works only for pure text, where they don't necessarily work are, for more complex text, where you have problem for the reading order, for instance if you have multiple column elements and if you have column spanning element, that often break these tools.<br />
If you don't have alt text for images, where should it come from? That also will be ignored, headers and footers can interfere, all of these things can be quite difficult.<br />
Now the problem is as soon as if you have any more complex content, i.e. math content as well as other things, then you can't really work with these PDF documents and these standard PDF readers alone. Unfortunately it's very little understood problem. and most people work with PDFs.<br />
Why can't we just get Maths for instance in a PDF document, because in many ways it's not there! and why it's not there, well, because the way PDF documents is structured, for those who don't know, it's in terms of arranging things along a baseline. and you just effectively have a baseline, on which you arrange characters, and these characters are arranged with particular base points, and you don't have really the information about what the character is, necessarily, or, the character is actually drawn on the canvas of the printed output, or on the screen.<br />
</p>
<h1 id="some-solutions">Some solutions</h1>
<ul class="incremental">
<li>Maxtract system (2008)</li>
<li>Full content extraction</li>
<li>Grammatical approach at PDF reconstruction</li>
<li>Very limited in terms of PDF versions it could handle</li>
<li>Current Ravi Project at IIT:
<ul class="incremental">
<li>Full extraction for client side rendering</li>
<li>Comprehensive approach</li>
<li>Reuses the good part of Maxtract</li>
</ul></li>
<li><a href="https://inftyproject.org/">Infty</a> system has implemented some of the Maxtract ideas</li>
<li><a href="http://apricot.cis.ibaraki.ac.jp/PDFtools/">Akio Fujiyoshi's Lab</a> has some nice solutions</li>
</ul>
<h1 id="born-accessible">Born Accessible</h1>
<p>Conversion to formats that are in principle accessible</p>
<ul class="incremental">
<li>PDF documents</li>
<li>ePub and similar formats, like Daisy</li>
<li>Web documents (as discussed in detail)</li>
</ul>
<h2 id="pdf-documents">PDF documents</h2>
<ul class="incremental">
<li>PDF can be made accessible, there is even a version: PDF/UA
<ul class="incremental">
<li>Requires a lot of "goodwill" by authors</li>
<li>Some tools are more suitable for generating accessible PDFs</li>
</ul></li>
<li>Word good, LaTeX not
<ul class="incremental">
<li>There are a number of tools for accessibility checking</li>
</ul></li>
<li>Some free
<ul class="incremental">
<li>Acrobat Pro is proprietary and not free</li>
</ul></li>
</ul>
<h2 id="generating-accessible-pdf">Generating accessible PDF</h2>
<ul class="incremental">
<li>Important: Reading order, Alt Texts, Header nesting</li>
<li>Word can generate PDF/UA without Math support</li>
<li>LaTeX has very poor support for PDF/UA</li>
<li>Adobe Acrobat Pro can help adding accessibility</li>
<li>Alternatively consider a pandoc workflow via Word</li>
<li>LaTeX is good for Maths but not for structure</li>
</ul>
<h2 id="pdf-current-state">PDF: Current state</h2>
<p>No generator for fully accessible PDF.</p>
<ul class="incremental">
<li>Fixing Accessibility issues is
<ul class="incremental">
<li>Time consuming</li>
<li>Often repetitive</li>
<li>Only work well in Acrobat Pro (proprietary + not free)</li>
</ul></li>
<li>PDF has multiple layers to hide additional information or alternative formats
<ul class="incremental">
<li>Poorly supported</li>
<li>No flexible reflow</li>
</ul></li>
</ul>
<h2 id="epubs">EPubs</h2>
<ul class="incremental">
<li>Format is close to HTML5</li>
<li>Same techniques as for our web documents apply</li>
<li>Some issues due to XHTML handling: namespaces, etc.</li>
<li>Epub readers very greatly
<ul class="incremental">
<li>provision of MathJax for Math</li>
<li>SVG for Diagrams</li>
<li>Javascript for accessibility</li>
</ul></li>
</ul>
<p>Let's have a look at the <a href="http://diagramcenter.org/diagram-reports/diagram-2020-report/multimodal-stem-documents.html#math-braille">diagram report</a> and <a href="chrome-extension://jhhclmfgfllimlhabjkgkeebkbiadflb/reader.html">Test with EPub reader</a></p>
<h2 id="other-alternative-formats-braille">Other Alternative Formats: Braille</h2>
<p>Source: LaTeX in <a href="https://pretextbook.org/">PreTeXt format</a><br />
Target: embossed Braille</p>
<ul class="incremental">
<li>PreTeXt is an XML markup with LaTeX for math.</li>
<li>PreTeXt books are translated automatically into Braille with
<ul class="incremental">
<li>Liblouis for the text</li>
<li>MathJax for formulas using SRE's Nemeth translation</li>
</ul></li>
<li>Multistep translation pipeline server-side using MathJax</li>
<li>Current pipeline is mainly a prototype</li>
<li>Tactile graphics still done primarily manually</li>
<li>Project with the NFB, PreTeXt and AIM</li>
</ul>
<h2 id="outlook">Outlook</h2>
<ul class="incremental">
<li>Diagrams</li>
<li>Sonfication</li>
<li>Advanced content</li>
</ul>

</body>
</html>